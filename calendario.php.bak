<?php
session_start();
include('dbconn.php');

$conn = new dbconnect();
$r = $conn->connect();
/*
$fd= fopen ("./files/CV.csv", "r");
$x=0;

while (!feof ($fd))
{
   $riga=fgets($fd, 4096);
   if($riga!="")
   {
       $riga = str_replace("'","",$riga);
      $arr=split(';', $riga);
      for($i=1;$i<count($arr);$i++){
          $email=split(" ",$arr[$i]);
          for($t=0;$t<3;$t++){
              $con[$i]="";
              if(trim($email[0])=="D"||trim($email[0])=="DI"||trim($email[0])=="DEL") $con[$i] .= trim($email[2]).".".trim($email[0]).trim($email[1]);
              else if(isset($email[2])&&$email[2]!=""){
                  $con[$i] .= trim($email[2]).".".trim($email[0]);
                                
              } else {
                        $con[$i] .= trim($email[1]).".".trim($email[0]);
                                if(isset($email[2])) $con[$i].= trim($email[2]);
              }

                      
              $con[$i] .= "@service-tech.org";
          }
          //print $arr[$i]."<br>";
      }
      $x++;
   }
}
for($f=0;$f<count($con);$f++){
    print strtolower($con[$f])."<br>";
}
print "";
fclose($fd);

*/

if(isset($_POST['modifica_x'])){
    
    if(isset($_REQUEST['ora_inizio'])&&$_REQUEST['ora_inizio']!=""&&isset($_REQUEST['minuti_inizio'])&&$_REQUEST['minuti_inizio']!=""){
        $ora_inizio = $_REQUEST['ora_inizio'].":".$_REQUEST['minuti_inizio'];
    }
    if(isset($_REQUEST['ora_fine'])&&$_REQUEST['ora_fine']!=""&&isset($_REQUEST['minuti_fine'])&&$_REQUEST['minuti_fine']!=""){
        $ora_fine = $_REQUEST['ora_fine'].":".$_REQUEST['minuti_fine'];
    }
   if(isset($_REQUEST['durata'])&&$_REQUEST['durata']!=""){
        $durata = $_REQUEST['durata'];
    }
    if(isset($_REQUEST['descrizione_attivita'])){
        $descrizione_attivita = $_REQUEST['descrizione_attivita'];
    }
     if(isset($_REQUEST['commessa'])){
        $commessa = $_REQUEST['commessa'];
    }
      if(isset($_REQUEST['tipo'])){
        $tipo = $_REQUEST['tipo'];
    }
    $query="UPDATE attivita SET ora_inizio='".$ora_inizio."',ora_fine='".$ora_fine."',ore_lavorate='".$durata."',commessa='".$commessa."',descrizione='".$descrizione_attivita."',tipo='".$tipo."' WHERE id_attivita=". $_POST['id_attivita'];
    $query_result=  mysql_query($query,$conn->db);
    //echo mysql_error();
   if (!$query_result) {
        die('Errore di aggiornamento dati: ' . mysql_error());
    } else {
            $alert = "<p align='center' style='color:green'>Attività modificata con successo!</p>";
        }
        
        if(isset($alert)&&$alert!=""){
            echo $alert;
        }
}


if(isset($_POST['add_commessa'])){
    $commesse=$_POST['commesse_string'];
    $commesse .= $_POST['commessa_add']."*";
    
    $query="update anagrafica set commesse ='".$commesse."' WHERE user_id =".$_GET['id_utente'];
    $result=  mysql_query($query);
    if(!$result){
    echo "Errore inserimento mdati nel DB: " .mysql_error();
    }
}


if(isset($_POST['commessa_input'])){

    $commesse=$_POST['commesse_string'];
    
    $string="*".$_POST['id_della_commessa']."*";
    $commesse = str_replace($string,"*",$commesse);
    
    $query="update anagrafica set commesse ='".$commesse."' WHERE user_id =".$_GET['id_utente'];
    $result=  mysql_query($query);
    if(!$result){
    echo "Errore inserimento mdati nel DB: " .mysql_error();
    }
}

if(isset($_POST['elimina_x'])){
    
    $query="DELETE FROM attivita WHERE id_attivita=". $_POST['id_attivita'];
    $query_result=  mysql_query($query,$conn->db);
    //echo mysql_error();
   if (!$query_result) {
        die('Errore di aggiornamento dati: ' . mysql_error());
    } else {
            $alert = "<p align='center' style='color:green'>Attività rimossa con successo!</p>";
        }
        
        if(isset($alert)&&$alert!=""){
            echo $alert;
        }
}

if(isset($_POST['aggiungi_x'])){
    
    if(isset($_REQUEST['ora_inizio'])&&$_REQUEST['ora_inizio']!=""&&isset($_REQUEST['minuti_inizio'])&&$_REQUEST['minuti_inizio']!=""){
        $ora_inizio = $_REQUEST['ora_inizio'].":".$_REQUEST['minuti_inizio'];
    }
    if(isset($_REQUEST['ora_fine'])&&$_REQUEST['ora_fine']!=""&&isset($_REQUEST['minuti_fine'])&&$_REQUEST['minuti_fine']!=""){
        $ora_fine = $_REQUEST['ora_fine'].":".$_REQUEST['minuti_fine'];
    }
   if(isset($_REQUEST['durata'])&&$_REQUEST['durata']!=""){
        $durata = $_REQUEST['durata'];
    }
    if(isset($_REQUEST['descrizione_attivita'])){
        $descrizione_attivita = $_REQUEST['descrizione_attivita'];
    }
     if(isset($_REQUEST['commessa'])){
        $commessa = $_REQUEST['commessa'];
    }
      if(isset($_REQUEST['tipo'])){
        $tipo = $_REQUEST['tipo'];
    }
    
    $query="INSERT INTO attivita (id_utente,ora_inizio,ora_fine,ore_lavorate,commessa,descrizione,giorno,mese,anno,tipo) 
        VALUES ('".$_SESSION['user_idd']."','".$ora_inizio."','".$ora_fine."','".$durata."','".$commessa."','".$descrizione_attivita."','".$_GET['day']."','".$_GET['month']."','".$_GET['year']."','".$tipo."')";
    $query_result=  mysql_query($query,$conn->db);
    //echo mysql_error();
   if (!$query_result) {
        die('Errore di aggiornamento dati: ' . mysql_error());
    } else {
            $alert = "<p align='center' style='color:green'>Attività aggiunta con successo!</p>";
        }
        
        if(isset($alert)&&$alert!=""){
            echo $alert;
        }
}

if (isset($_REQUEST['action'])) {
    $action = $_REQUEST['action'];
} else {
    $action = '';
}

switch ($action) {
		
case 'Vai':

if (isset($_REQUEST['mese'])&&$_REQUEST['mese']!="") {
            $id_mese = $_REQUEST['mese'];
        } 
		
if (isset($_REQUEST['anno'])&&$_REQUEST['anno']!="") {
            $id_anno = $_REQUEST['anno'];
        } 

break;
	
}

if (!isset($id_mese)) {
            $id_mese = date("m");
        } 
		
if (!isset($id_anno)) {
            $id_anno = date("Y");
        }

if (!isset($_REQUEST['num_giorni'])) {
			if(!checkdate($id_mese,28+1,$id_anno)) { $num_giorni = 28;}
			else if(!checkdate($id_mese,29+1,$id_anno)) { $num_giorni = 29;}
			else if(!checkdate($id_mese,30+1,$id_anno)) { $num_giorni = 30;}
			else if(!checkdate($id_mese,31+1,$id_anno)) { $num_giorni = 31;}
}

if(isset($_SESSION['logged'])) {

	if($id_mese==1) {$mese="Gennaio"; $id_mese="01";}
	if($id_mese==2) {$mese="Febbraio"; $id_mese="02";}
	if($id_mese==3) {$mese="Marzo"; $id_mese="03";}
	if($id_mese==4) {$mese="Aprile"; $id_mese="04";}
	if($id_mese==5) {$mese="Maggio"; $id_mese="05";}
	if($id_mese==6) {$mese="Giugno"; $id_mese="06";}
	if($id_mese==7) {$mese="Luglio"; $id_mese="07";}
	if($id_mese==8) {$mese="Agosto"; $id_mese="08";}
	if($id_mese==9) {$mese="Settembre"; $id_mese="09";}
	if($id_mese==10) $mese="Ottobre"; 
	if($id_mese==11) $mese="Novembre"; 
	if($id_mese==12) $mese="Dicembre"; 
	
}
	
?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Timesheet</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link href="boilerplate.css" rel="stylesheet" type="text/css">
<link href="css/css.css" rel="stylesheet" type="text/css">
<link href="css/styles.css" rel="stylesheet" type="text/css">
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
  <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
        <script language="javascript"> 
    function toggleMe(obj, a){ 
      var e=document.getElementById(a); 
      if(obj=="PR"){ 
        e.style.display="block"; 
      }else{ 
    e.style.display="none"; 
} 
    } 
</script> 
        <script type="text/javascript">
        
function durata_tot(id){ 
    if(id=="0") id = "";
       var id1 = "minuti_fine"+id;
       var id2 = "ora_fine"+id;
       var id3 = "ora_inizio"+id;
       var id4 = "minuti_inizio"+id;
       var id5 = "durata"+id;
       

      if(document.getElementById(id1).value=="Minuti") var mf=0;
      else mf=(document.getElementById(id1).value)-0;

      if(document.getElementById(id3).value=="Ora") var hi=0;
      else hi=(document.getElementById(id3).value)-0; 
      if(document.getElementById(id2).value=="Ora") hf=0;
      else hf=(document.getElementById(id2).value)-0;
      if(document.getElementById(id4).value=="Minuti") mi=0;
      else mi=(document.getElementById(id4).value)-0;
      
      
      var ore = hf-hi;
      var minuti = mf - mi;
       if(hi<=13&&hf>=14) ore = ore - 1;
      if(minuti<0) var minuti = minuti + 60;
      
      if(ore<0||(hf==hi&&mi>mf)) var somma = "Errore";
      else var somma = ore + "h" + minuti;

     

      document.getElementById(id5).value = somma;
      }  
     
        
        </script>
    <script type="text/javascript">
        $("#day").click(function()
{
    alert('ciao');
    document.location.href = "amministrazione.php";
});
        </script>
    <style>
body {
	background: #fafafa ;
	color: #444;
	font: 100%/30px 'Helvetica Neue', helvetica, arial, sans-serif;
}

strong {
	font-weight: bold; 
}

em {
	font-style: italic; 
}

table.cal {
	background: #f5f5f5;
	border-collapse: separate;
	box-shadow: inset 0 1px 0 #fff;
	font-size: 12px;
	line-height: 24px;
	margin: 30px auto;
	text-align: left;
        color: #000;
}	

table.cal th {
	background: linear-gradient(#333, #444);
	border-left: 1px solid #555;
	border-right: 1px solid #777;
	border-top: 1px solid #555;
	border-bottom: 1px solid #333;
	box-shadow: inset 0 1px 0 #999;
	color: #fff;
  font-weight: bold;
	padding: 10px 10px;
	position: relative;
}


table.cal th:first-child {
	border-left: 1px solid #777;	
	box-shadow: inset 1px 1px 0 #999;
}

table.cal th:last-child {
	box-shadow: inset -1px 1px 0 #999;
}

table.cal td {
	border-right: 1px solid #fff;
	border-left: 1px solid #e8e8e8;
	border-top: 1px solid #fff;
	border-bottom: 1px solid #e8e8e8;
	padding: 10px 15px;
	position: relative;
	transition: all 300ms;
	height:40px;
	width:auto;
        line-height: 40px;
	
}

table.cal td:first-child {
	box-shadow: inset 1px 0 0 #fff;
}	

table.cal td:last-child {
	border-right: 1px solid #e8e8e8;
	box-shadow: inset -1px 0 0 #fff;
}	


tr:last-of-type td {
	box-shadow: inset 0 -1px 0 #fff; 
}

table.cal tr:last-of-type td:first-child {
	box-shadow: inset 1px -1px 0 #fff;
}	

table.cal tr:last-of-type td:last-child {
	box-shadow: inset -1px -1px 0 #fff;
}	

</style>

        <style type="text/css">
            .festivi {
		background-color:#BB484A;
	}
	
	.sab_dom{
		background-color:#8B8B8B;
	}
	
	#giorni {
		background:#92a181;
background: -moz-linear-gradient(top, #92a181 0%, #7bab4b 50%, #a2b478 100%);
background: -webkit-linear-gradient(top, #92a181 0%,#7bab4b 50%,#a2b478 100%);
background: linear-gradient(to bottom, #92a181 0%,#7bab4b 50%,#a2b478 100%);
border-radius:12px;
		
	}
.btn {
  background: #fff;
  background-image: -webkit-linear-gradient(top, #6b6969, #eef0ed);
  background-image: -moz-linear-gradient(top, #6b6969, #eef0ed);
  background-image: -ms-linear-gradient(top, #6b6969, #eef0ed);
  background-image: -o-linear-gradient(top, #6b6969, #eef0ed);
  background-image: linear-gradient(to bottom, #6b6969, #eef0ed);
  -webkit-border-radius: 5;
  -moz-border-radius: 5;
  border-radius: 5px;
  font-family: Georgia;
  color:#FFF; 
  font-size: 15px;
  padding: 10px 20px 10px 20px;
  text-decoration: none;
  height:30px;
  line-height:10px;
}


.btn2 {
  background: #fff;
  background-image: -webkit-linear-gradient(top, #e0e0e0, #b3b3b3);
  background-image: -moz-linear-gradient(top, #e0e0e0, #b3b3b3);
  background-image: -ms-linear-gradient(top, #e0e0e0, #b3b3b3);
  background-image: -o-linear-gradient(top, #e0e0e0, #b3b3b3);
  background-image: linear-gradient(to bottom, #e0e0e0, #b3b3b3);
  -webkit-border-radius: 5;
  -moz-border-radius: 5;
  border-radius: 5px;
  font-family: Georgia;
  color:#FFF; 
  font-size: 15px;
  padding: 10px 10px 10px 10px;
  text-decoration: none;
  height:30px;
  line-height:5px;
  width:100px;
}


.btn2:hover {
  background: #e0e0e0;
  background-image: -webkit-linear-gradient(top, #a8a5a5, #050505);
  background-image: -moz-linear-gradient(top, #a8a5a5, #050505);
  background-image: -ms-linear-gradient(top, #a8a5a5, #050505);
  background-image: -o-linear-gradient(top, #a8a5a5, #050505);
  background-image: linear-gradient(to bottom, #a8a5a5, #050505);
  text-decoration: none;
  color:#FFF;
}
.btn3 {
  background: #fff;
  background-image: -webkit-linear-gradient(top, #DF0F0F, #c91a1a);
  background-image: -moz-linear-gradient(top, #DF0F0F, #c91a1a);
  background-image: -ms-linear-gradient(top, #DF0F0F, #c91a1a);
  background-image: -o-linear-gradient(top, #DF0F0F, #c91a1a);
  background-image: linear-gradient(top bottom, #DF0F0F, #c91a1a);
  -webkit-border-radius: 5;
  -moz-border-radius: 5;
  border-radius: 5px;
  font-family: Georgia;
  color:#000; 
  font-size: 15px;
  padding: 10px 10px 10px 10px;
  text-decoration: none;
  height:10px;
  line-height:0px;
}
</style>
  <style type="text/css" media="screen,print">
  table.time {
   border: 1px solid #000;
   border-collapse: collapse;
   font-family: Georgia, Times, serif;
   width:700px;
   height:450px;
   color:#000;
   }
   .time th {
   border: 1px solid #000;
   font-size: 90%;
   text-transform: uppercase;
   background-color: #090;
   height:10px;
   border-radius:0;
   }
   .time td {
   border: 1px solid #000;
   height: 5em;
   width:5em;
   padding: 5px;
   vertical-align: top;
   }
   .time caption {
   font-size: 300%;
   font-style: italic;
   }
   .day {
   text-align: center;
   font-size:15px;
   font-weight: bold;
   
   }
   .notes {
   font-family: Arial, Helvetica, sans-serif;
   font-size: 80%;
   text-align: right;
   padding-left: 20px;
 
   }
   .holiday {
   background-color: #DF0F0F;
   color:#FFF;
   }
   .weekend {
   background-color: #B3B3B3;
   color: #000;
   }
   .weekday {
	background-color: #fff; 
   }
  </style>
</head>
<body>
<div class="gridContainer clearfix">
 <div id="div1" class="fluid">
<div class="container">

<?php include('menu_top.php');?>
     
<!-- DIV CONTENITORE -->
<div style="margin-top:10px; ">
<div class="ficheaddleft">
<div id="info" style="margin-top:-70px; margin-left:70px;">
<?php 

if (isset($_SESSION['logged'])&&!isset($_GET['day'])&&!isset($_GET['id'])) {
    ?>

<br>
<center>

<form action="" method="post">
  <table width="240" cellspacing="5" style="margin-top:50px;">
  <tbody>
    <tr>
      <th scope="col">
<select class="shadows" name="mese" class="margin-top:8px;">
                                                <?php for($month=1;$month<=12;$month++)
 {
	 if($month==1) $mese_cal="Gennaio"; 
	if($month==2) $mese_cal="Febbraio"; 
	if($month==3) $mese_cal="Marzo"; 
	if($month==4) $mese_cal="Aprile"; 
	if($month==5) $mese_cal="Maggio"; 
	if($month==6) $mese_cal="Giugno"; 
	if($month==7) $mese_cal="Luglio"; 
	if($month==8) $mese_cal="Agosto"; 
	if($month==9) $mese_cal="Settembre"; 
	if($month==10) $mese_cal="Ottobre"; 
	if($month==11) $mese_cal="Novembre"; 
	if($month==12) $mese_cal="Dicembre"; 
	 ?>
                            <option <?php if($id_mese==$month) { ?>selected="selected"<?php } ?> value="<?php echo $month; ?>"><?php echo $mese_cal; ?></option>
                            <?php 
 }
 
 ?>
                            </select>
                             </th>
      
      <th scope="col">
<select class="shadows" name="anno" class="margin-top:8px;">
                                                <?php for($year=2016;$year>=2010;$year--)
 {
	 ?>
                            <option <?php if($id_anno==$year) { ?>selected="selected"<?php } ?> value="<?php echo $year; ?>"><?php echo $year; ?></option>
                            <?php 
 }
 
 ?>
                            </select>
  </th>
      
      
      <th scope="col">
                            <input type="image" name="action" src="img/vai2.png" value="Vai" style="margin-top:3px; width: 100px;">
                               
                            </th>
        <?php /*$query="SELECT * from commesse where id_responsabile=".$_SESSION['user_idd'];
                $result = mysql_query($query,$conn->db);*/
                if(isset($_SESSION['responsabile'])&&$_SESSION['responsabile']==1){
              
                ?>
         <th scope="col">
                            
             <input type="button" name="admin_attivita" value="Convalida Attività" onclick="location.href='calendario.php?id=attivita'">
                            </th>
          <th scope="col">
                            
             <input type="button" name="admin_commessa" value="Abilita Utente" onclick="location.href='calendario.php?id=utenti'">
                            </th>
                <?php } ?>
    </tr>
  </tbody>
</table>
</center>
 </form>
 <br>
<center>


<?php if(isset($motivo)&&$motivo!="") {?> <h2 id="motivo" class="fluid " style="font-family:play; font-size:20px; margin-top:-20px; color:red;">Il Timesheet di questo mese non è stato convalidato<br><?php echo $motivo;?></h2><?php }?>
<?php if(isset($convalidato)&&$convalidato==1) {?> <h2 id="motivo" class="fluid " style="font-family:play; font-size:20px; margin-top:-20px; color:green;">Il Timesheet di questo mese è stato convalidato</h2><?php }?>
<div id="contenitore1" class="fluid ">
 <form action="" method="post">
     <table align="center" width="70%" height="auto" border="1" padding="0" class="cal" style="margin-top:-20px;">
    <tr>
  <col class="weekday" span="5">
  <col class="weekend">
  <col class="weekend">
  <thead>
      <tr><td colspan="7" style="color:#fff; font-size: 35px; height: 100%; background-color: #960a19;"><?php echo $mese . " " . $id_anno; ?></td></tr>
    <tr>
        <th style="color:#8ec25a; font-size:16px; text-align: center;">Lun</th>
        <th style="color:#8ec25a; font-size:16px;text-align: center;">Mar</th>
      <th style="color:#8ec25a; font-size:16px;text-align: center;">Mer</th>
      <th style="color:#8ec25a; font-size:16px;text-align: center;">Gio</th>
      <th style="color:#8ec25a; font-size:16px;text-align: center;">Ven</th>
      <th style="color:#8ec25a; font-size:16px;text-align: center;">Sab</th>
      <th style="color:#8ec25a; font-size:16px;text-align: center;">Dom</th>
    </tr>
  </thead>
  <tbody>
		<?php

		$inizio = date("l", mktime(0, 0, 0, $id_mese, 1, $id_anno));

                
		if($inizio=="Monday")
		{
			?>
            <?php
			
		for($i=1;$i<=$num_giorni;$i++)
		{
                    
                    $timesheet = "SELECT  
				ore_lavorate,
                                stato,
                                tipo
                                                        
                                FROM attivita 
                                    
                                                   WHERE id_utente='" . $_SESSION['user_idd']."'"
                                                            . "AND giorno = '". $i."'"
                                                         . "AND mese = '". $id_mese . "' "
                                                         . "AND anno = '". $id_anno."'";

    $result_timesheet = mysql_query($timesheet, $conn->db);
	$somma=0;
        $stato="";
	if (mysql_num_rows($result_timesheet) > 0) {
	$control=0;
while ($row = mysql_fetch_array($result_timesheet, MYSQL_ASSOC)) {
    
 if($row['stato']=="Non Validato") { $stato = "Non Validato"; $control = 1;}
 if($row['stato']=="Rifiutato"&&$control!=1) {$stato = "Rifiutato"; $control = 1;}
 if($row['stato']=="Validato"&&$control!=1&&$control!=2) {$stato = "Validato";}
 if($row['tipo']=="P" ) $somma=$somma + $row['ore_lavorate'];
    
}
  
        }
			$festa="";
			if($id_mese==1 && $i==1) $festa="Capodanno";
			if($id_mese==1 && $i==6) $festa="Befana";
			if($id_mese==4 && $i==25) $festa="Liberazione";
			if($id_mese==5 && $i==1) $festa="Lavoratori";
			if($id_mese==6 && $i==2) $festa="Repubblica";
			if($id_mese==8 && $i==15) $festa="Ferragosto";
			if($id_mese==11 && $i==1) $festa="Ognissanti";
			if($id_mese==12 && $i==8) $festa="Immacolata";
			if($id_mese==12 && $i==25) $festa="Natale";
			if($id_mese==12 && $i==26) $festa="Stefano";
		   if($i==1||$i==8||$i==15||$i==22||$i==29)
		   {
                       ?>
      
      <tr>
         <?php
		   }
		   ?>
        <td <?php if($festa!="") { ?> class="holiday" <?php } ?> onclick="location.href='calendario.php?day=<?php echo $i;?>&month=<?php echo $id_mese?>&year=<?php echo $id_anno?>';" style="cursor:pointer;" <?php if($festa!="") { ?> class="holiday" <?php } ?>>
                 <div class="day"><?php echo $i;?></div>
                 <?php echo $somma ?> su 8<br>
                     <?php echo $stato?><br>
                         
             </td>
		<?php
			if($i==7||$i==14||$i==21||$i==28)
			{
		?> 
         	</tr>
         <?php
		 	}
		}
		}
		if($inizio=="Tuesday")
		{
			?>
            <tr><td><div class="day"></div></td>
            <?php
		for($i=2;$i<=$num_giorni+1;$i++)
		{
                    
                    $t=$i-1;
                                  $timesheet = "SELECT  
				ore_lavorate,
                                stato,
                                tipo
                                                        
                                FROM attivita 
                                    
                                                   WHERE id_utente='" . $_SESSION['user_idd']."'"
                                                            . "AND giorno = '". $t."'"
                                                         . "AND mese = '". $id_mese . "' "
                                                         . "AND anno = '". $id_anno."'";

    $result_timesheet = mysql_query($timesheet, $conn->db);
	$somma=0;
        $stato="";
        if (mysql_num_rows($result_timesheet) > 0) {
	$control=0;
while ($row = mysql_fetch_array($result_timesheet, MYSQL_ASSOC)) {
    
 if($row['stato']=="Non Validato") { $stato = "Non Validato"; $control = 1;}
 if($row['stato']=="Rifiutato"&&$control!=1) {$stato = "Rifiutato"; $control = 1;}
 if($row['stato']=="Validato"&&$control!=1&&$control!=2) {$stato = "Validato";}
if($row['tipo']=="P" ) $somma=$somma + $row['ore_lavorate'];
    
}
  
        }
			
			$festa="";
			if($id_mese==1 && $i==2) $festa="Capodanno";
			if($id_mese==1 && $i==7) $festa="Befana";
			if($id_mese==4 && $i==26) $festa="Liberazione";
			if($id_mese==5 && $i==2) $festa="Lavoratori";
			if($id_mese==6 && $i==3) $festa="Repubblica";
			if($id_mese==8 && $i==16) $festa="Ferragosto";
			if($id_mese==11 && $i==2) $festa="Ognissanti";
			if($id_mese==12 && $i==9) $festa="Immacolata";
			if($id_mese==12 && $i==26) $festa="Natale";
			if($id_mese==12 && $i==27) $festa="Stefano";
		   if($i==1||$i==8||$i==15||$i==22||$i==29)
		   {
		?> 
         <tr>
         <?php
		   }
		   ?>
           <td onclick="location.href='calendario.php?day=<?php echo $i-1;?>&month=<?php echo $id_mese?>&year=<?php echo $id_anno?>';" style="cursor:pointer;" <?php if($festa!="") { ?> class="holiday" <?php } ?>>
                 <div class="day"><?php echo $i-1;?></div>
                 <?php echo $somma ?> su 8<br>
                     <?php echo $stato?><br>
                         
             </td>
		<?php
			if($i==7||$i==14||$i==21||$i==28)
			{
		?> 
         	</tr>
         <?php
		 	}
		}
		}
		if($inizio=="Wednesday")
		{
			?>
            <tr><td><div class="day"></div></td>
            <td><div class="day"></div></td>
            <?php
		for($i=3;$i<=$num_giorni+2;$i++)
		{
                    $t=$i-2;
                                  $timesheet = "SELECT  
				ore_lavorate,
                                stato,
                                tipo
                                                        
                                FROM attivita 
                                    
                                                   WHERE id_utente='" . $_SESSION['user_idd']."'"
                                                            . "AND giorno = '". $t."'"
                                                         . "AND mese = '". $id_mese . "' "
                                                         . "AND anno = '". $id_anno."'";

    $result_timesheet = mysql_query($timesheet, $conn->db);
	$somma=0;
        $stato="";
	if (mysql_num_rows($result_timesheet) > 0) {
	$control=0;
while ($row = mysql_fetch_array($result_timesheet, MYSQL_ASSOC)) {
    
 if($row['stato']=="Non Validato") { $stato = "Non Validato"; $control = 1;}
 if($row['stato']=="Rifiutato"&&$control!=1) {$stato = "Rifiutato"; $control = 1;}
 if($row['stato']=="Validato"&&$control!=1&&$control!=2) {$stato = "Validato";}
if($row['tipo']=="P" ) $somma=$somma + $row['ore_lavorate'];
    
}
  
        }
			
			$festa="";
			if($id_mese==1 && $i==3) $festa="Capodanno";
			if($id_mese==1 && $i==8) $festa="Befana";
			if($id_mese==4 && $i==27) $festa="Liberazione";
			if($id_mese==5 && $i==3) $festa="Lavoratori";
			if($id_mese==6 && $i==4) $festa="Repubblica";
			if($id_mese==8 && $i==17) $festa="Ferragosto";
			if($id_mese==11 && $i==3) $festa="Ognissanti";
			if($id_mese==12 && $i==10) $festa="Immacolata";
			if($id_mese==12 && $i==27) $festa="Natale";
			if($id_mese==12 && $i==28) $festa="Stefano";
		   if($i==1||$i==8||$i==15||$i==22||$i==29)
		   {
		?> 
         <tr>
         <?php
		   }
		   ?>
             <td onclick="location.href='calendario.php?day=<?php echo $i-2;?>&month=<?php echo $id_mese?>&year=<?php echo $id_anno?>';" style="cursor:pointer;" <?php if($festa!="") { ?> class="holiday" <?php } ?>>
                 <div class="day"><?php echo $i-2;?></div>
                 <?php echo $somma ?> su 8<br>
                     <?php echo $stato?><br>
                         
             </td>
    	
		<?php
			if($i==7||$i==14||$i==21||$i==28)
			{
		?> 
         	</tr>
         <?php
		 	}
		}
	}
	if($inizio=="Thursday")
		{
			?>
            <tr><td><div class="day"></div></td>
            <td><div class="day"></div></td>
            <td><div class="day"></div></td>
            <?php
		for($i=4;$i<=$num_giorni+3;$i++)
		{            
                    $t=$i-3;
                    $timesheet = "SELECT  
				ore_lavorate,
                                stato,
                                tipo
                                                        
                                FROM attivita 
                                    
                                                   WHERE id_utente='" . $_SESSION['user_idd']."'"
                                                            . "AND giorno = '". $t."'"
                                                         . "AND mese = '". $id_mese . "' "
                                                         . "AND anno = '". $id_anno."'";

    $result_timesheet = mysql_query($timesheet, $conn->db);
	$somma=0;
        $stato="";
	if (mysql_num_rows($result_timesheet) > 0) {
	$control=0;
while ($row = mysql_fetch_array($result_timesheet, MYSQL_ASSOC)) {
    
 if($row['stato']=="Non Validato") { $stato = "Non Validato"; $control = 1;}
 if($row['stato']=="Rifiutato"&&$control!=1) {$stato = "Rifiutato"; $control = 1;}
 if($row['stato']=="Validato"&&$control!=1&&$control!=2) {$stato = "Validato";}
 if($row['tipo']=="P" ) $somma=$somma + $row['ore_lavorate'];
    
    
}
  
        }
			$festa="";
			if($id_mese==1 && $i==4) $festa="Capodanno";
			if($id_mese==1 && $i==9) $festa="Befana";
			if($id_mese==4 && $i==28) $festa="Liberazione";
			if($id_mese==5 && $i==4) $festa="Lavoratori";
			if($id_mese==6 && $i==5) $festa="Repubblica";
			if($id_mese==8 && $i==18) $festa="Ferragosto";
			if($id_mese==11 && $i==4) $festa="Ognissanti";
			if($id_mese==12 && $i==11) $festa="Immacolata";
			if($id_mese==12 && $i==28) $festa="Natale";
			if($id_mese==12 && $i==29) $festa="Stefano";
		   if($i==1||$i==8||$i==15||$i==22||$i==29)
		   {
		?> 
         <tr>
         <?php
		   }
		   ?>
         <td onclick="location.href='calendario.php?day=<?php echo $i-3;?>&month=<?php echo $id_mese?>&year=<?php echo $id_anno?>';" style="cursor:pointer;" <?php if($festa!="") { ?> class="holiday" <?php } ?>>
                 <div class="day"><?php echo $i-3;?></div>
                 <?php echo $somma ?> su 8<br>
                     <?php echo $stato?><br>
                         
             </td>
		<?php
			if($i==7||$i==14||$i==21||$i==28)
			{
		?> 
         	</tr>
         <?php
		 	}
		}
	}
	if($inizio=="Friday")
		{
			?>
            <tr><td><div class="day"></div></td>
            <td><div class="day"></div></td>
            <td><div class="day"></div></td>
            <td><div class="day"></div></td>
            <?php
		for($i=5;$i<=$num_giorni+4;$i++)
		{
                    
                    $t=$i-4;
                    $timesheet = "SELECT  
				ore_lavorate,
                                stato,
                                tipo
                                                        
                                FROM attivita 
                                    
                                                   WHERE id_utente='" . $_SESSION['user_idd']."'"
                                                            . "AND giorno = '". $t."'"
                                                         . "AND mese = '". $id_mese . "' "
                                                         . "AND anno = '". $id_anno."'";

    $result_timesheet = mysql_query($timesheet, $conn->db);
	$somma=0;
        $stato="";
	if (mysql_num_rows($result_timesheet) > 0) {
	$control=0;
while ($row = mysql_fetch_array($result_timesheet, MYSQL_ASSOC)) {
    
 if($row['stato']=="Non Validato") { $stato = "Non Validato"; $control = 1;}
 if($row['stato']=="Rifiutato"&&$control!=1) {$stato = "Rifiutato"; $control = 1;}
 if($row['stato']=="Validato"&&$control!=1&&$control!=2) {$stato = "Validato";}
if($row['tipo']=="P" ) $somma=$somma + $row['ore_lavorate'];
    
    
}
  
        }
			$festa="";
			if($id_mese==1 && $i==5) {$festa="Capodanno";}
			if($id_mese==1 && $i==10){ $festa="Befana";}
			if($id_mese==4 && $i==29) $festa="Liberazione";
			if($id_mese==5 && $i==5) $festa="Lavoratori";
			if($id_mese==6 && $i==6) $festa="Repubblica";
			if($id_mese==8 && $i==19) $festa="Ferragosto";
			if($id_mese==11 && $i==5) $festa="Ognissanti";
			if($id_mese==12 && $i==12) $festa="Immacolata";
			if($id_mese==12 && $i==29) $festa="Natale";
			if($id_mese==12 && $i==30) $festa="Stefano";
		   if($i==1||$i==8||$i==15||$i==22||$i==29)
		   {
		?> 
         <tr>
         <?php
		   }
		   ?>
  <td onclick="location.href='calendario.php?day=<?php echo $i-4;?>&month=<?php echo $id_mese?>&year=<?php echo $id_anno?>';" style="cursor:pointer;" <?php if($festa!="") { ?> class="holiday" <?php } ?>>
                 <div class="day"><?php echo $i-4;?></div>
                 <?php echo $somma ?> su 8<br>
                     <?php echo $stato?><br>
                         
             </td>
		<?php
			if($i==7||$i==14||$i==21||$i==28)
			{
		?> 
         	</tr>
         <?php
		 	}
		}
	}
	if($inizio=="Saturday")
		{
			?>
            <tr><td><div class="day"></div></td>
            <td><div class="day"></div></td>
            <td><div class="day"></div></td>
            <td><div class="day"></div></td>
            <td><div class="day"></div></td>
            <?php
		for($i=6;$i<=$num_giorni+5;$i++)
		{
                                 $t=$i-5;
                    $timesheet = "SELECT  
				ore_lavorate,
                                stato,
                                tipo
                                                        
                                FROM attivita 
                                    
                                                   WHERE id_utente='" . $_SESSION['user_idd']."'"
                                                            . "AND giorno = '". $t."'"
                                                         . "AND mese = '". $id_mese . "' "
                                                         . "AND anno = '". $id_anno."'";

    $result_timesheet = mysql_query($timesheet, $conn->db);
	$somma=0;
        $stato="";
	if (mysql_num_rows($result_timesheet) > 0) {
		$control=0;
while ($row = mysql_fetch_array($result_timesheet, MYSQL_ASSOC)) {
    
 if($row['stato']=="Non Validato") { $stato = "Non Validato"; $control = 1;}
 if($row['stato']=="Rifiutato"&&$control!=1) {$stato = "Rifiutato"; $control = 1;}
 if($row['stato']=="Validato"&&$control!=1&&$control!=2) {$stato = "Validato";}
if($row['tipo']=="P" ) $somma=$somma + $row['ore_lavorate'];
}
  
        }
			$festa="";
			if($id_mese==1 && $i==6) {$festa="Capodanno";}
			if($id_mese==1 && $i==11){ $festa="Befana";}
			if($id_mese==4 && $i==30) $festa="Liberazione";
			if($id_mese==5 && $i==6) $festa="Lavoratori";
			if($id_mese==6 && $i==7) $festa="Repubblica";
			if($id_mese==8 && $i==20) $festa="Ferragosto";
			if($id_mese==11 && $i==6) $festa="Ognissanti";
			if($id_mese==12 && $i==13) $festa="Immacolata";
			if($id_mese==12 && $i==30) $festa="Natale";
			if($id_mese==12 && $i==31) $festa="Stefano";
		   if($i==1||$i==8||$i==15||$i==22||$i==29)
		   {
		?> 
         <tr>
         <?php
		   }
		   ?>
    <td onclick="location.href='calendario.php?day=<?php echo $i-5;?>&month=<?php echo $id_mese?>&year=<?php echo $id_anno?>';" style="cursor:pointer;" <?php if($festa!="") { ?> class="holiday" <?php } ?>>
                 <div class="day"><?php echo $i-5;?></div>
                 <?php echo $somma ?> su 8<br>
                     <?php echo $stato?><br>
                         
             </td>
		<?php
			if($i==7||$i==14||$i==21||$i==28||$i==35)
			{
		?> 
         	</tr>
         <?php
		 	}
		}
	}
	if($inizio=="Sunday")
		{
			?>
            <tr><td><div class="day"></div></td>
            <td><div class="day"></div></td>
            <td><div class="day"></div></td>
            <td><div class="day"></div></td>
            <td><div class="day"></div></td>
            <td><div class="day"></div></td>
            <?php
		for($i=7;$i<=$num_giorni+6;$i++)
		{
                                 $t=$i-6;
                    $timesheet = "SELECT  
				ore_lavorate,
                                stato,
                                tipo
                                                        
                                FROM attivita 
                                    
                                                   WHERE id_utente='" . $_SESSION['user_idd']."'"
                                                            . "AND giorno = '". $t."'"
                                                         . "AND mese = '". $id_mese . "' "
                                                         . "AND anno = '". $id_anno."'";

    $result_timesheet = mysql_query($timesheet, $conn->db);
	$somma=0;
        $stato="";
	if (mysql_num_rows($result_timesheet) > 0) {
		$control=0;
while ($row = mysql_fetch_array($result_timesheet, MYSQL_ASSOC)) {
    
 if($row['stato']=="Non Validato") { $stato = "Non Validato"; $control = 1;}
 if($row['stato']=="Rifiutato"&&$control!=1) {$stato = "Rifiutato"; $control = 1;}
 if($row['stato']=="Validato"&&$control!=1&&$control!=2) {$stato = "Validato";}
 if($row['tipo']=="P" )$somma=$somma + $row['ore_lavorate'];
    
}
  
        }
			$festa="";
			if($id_mese==1 && $i==7) {$festa="Capodanno";}
			if($id_mese==1 && $i==12){ $festa="Befana";}
			if($id_mese==4 && $i==31) $festa="Liberazione";
			if($id_mese==5 && $i==7) $festa="Lavoratori";
			if($id_mese==6 && $i==8) $festa="Repubblica";
			if($id_mese==8 && $i==21) $festa="Ferragosto";
			if($id_mese==11 && $i==7) $festa="Ognissanti";
			if($id_mese==12 && $i==14) $festa="Immacolata";
			if($id_mese==12 && $i==31) $festa="Natale";
			if($id_mese==12 && $i==32) $festa="Stefano";
		   if($i==1||$i==8||$i==15||$i==22||$i==29)
		   {
		?> 
         <tr>
         <?php
		   }
		   ?>
     <td onclick="location.href='calendario.php?day=<?php echo $i-6;?>&month=<?php echo $id_mese?>&year=<?php echo $id_anno?>';" style="cursor:pointer;" <?php if($festa!="") { ?> class="holiday" <?php } ?>>
                 <div class="day"><?php echo $i-6;?></div>
                 <?php echo $somma ?> su 8<br>
                     <?php echo $stato?><br>
                         
             </td>
		<?php
			if($i==7||$i==14||$i==21||$i==28||$i==35)
			{
		?> 
         	</tr>
         <?php
		 	}
		}
	
     
}

	?>
  </tbody>
</table>
<!--<table width="50%" cellspacing="5" id="bordotab" style="margin-top:50px;">
  <tbody>
    <tr>
      <th scope="col" class="span"><strong>Legenda</strong><br></th>
    </tr>
 
    
    <tr>
      <td>P=Presente&nbsp;&nbsp;&nbsp;&nbsp;M=Malattia&nbsp;&nbsp;&nbsp;&nbsp;M1=Maternità</td></td>
    </tr>
    <tr>
      <td>F=Ferie&nbsp;&nbsp;&nbsp;&nbsp;PR=Permessi&nbsp;&nbsp;&nbsp;&nbsp;EX=Ex Festività</td>
      <tr>
      <td>FE=Festività</td>
    </tr>
  </tbody>
</table>
  <input type="image" value="Salva Timesheet" name="action" src="img/salva.png"/><input type="image" src="img/invia.png" value="Invia Timesheet" name="action"/></div>
<input type="hidden" name="numero_giorni" value="<?php echo $num_giorni?>" />
<input type="hidden" name="mese_time" value="<?php echo $id_mese?>" />
<input type="hidden" name="anno_time" value="<?php echo $id_anno?>" />-->
</form>
</div>
</div>
</div>
</div>
 </div>
</div>
<?php 
} else if(isset($_SESSION['logged'])&&isset($_GET['day'])) {
    
    if(!checkdate($_GET['month']-1,28+1,$_GET['year'])) { $num_giorni_prec = 28;}
			else if(!checkdate($_GET['month']-1,29+1,$_GET['year'])) { $num_giorni_prec = 29;}
			else if(!checkdate($_GET['month']-1,30+1,$_GET['year'])) { $num_giorni_prec = 30;}
			else if(!checkdate($_GET['month']-1,31+1,$_GET['year'])) { $num_giorni_prec = 31;}
                        
                            if(!checkdate($_GET['month'],28+1,$_GET['year'])) { $num_giorni_ora = 28;}
			else if(!checkdate($_GET['month'],29+1,$_GET['year'])) { $num_giorni_ora = 29;}
			else if(!checkdate($_GET['month'],30+1,$_GET['year'])) { $num_giorni_ora = 30;}
			else if(!checkdate($_GET['month'],31+1,$_GET['year'])) { $num_giorni_ora = 31;}
    
          if($_GET['day']<10) $realday = "0".$_GET['day'];
        else $realday = $_GET['day'];
    if($_GET['day']>1) { 
        $sx= $_GET['day'] - 1;
        $sx_month = $_GET['month'];
        $sx_year = $_GET['year'];
  
    }
    else { 
        
        if($_GET['day']=="1"&&$_GET['month']=="01"){
            $sx_month = 12;
            $sx_year = $_GET['year'] -1;
            $sx= 31;
        }
        else {

        $sx = $num_giorni_prec;
        if($_GET['month']<=10) {
            $sx_month = $_GET['month'] - 1;
            $sx_month = "0".$sx_month;
        } else {
            $sx_month = $_GET['month'] - 1;
        }
        $sx_year = $_GET['year'];
        }
    }
    
    if($_GET['day']<10) $realday = "0".$_GET['day'];
        else $realday = $_GET['day'];
        
    if($_GET['day']<$num_giorni_ora) { 
        $dx= $_GET['day'] + 1;
        $dx_month = $_GET['month'];
        $dx_year = $_GET['year'];
  
    }
    else { 
        
        if($_GET['day']==31&&$_GET['month']==12){
            $dx_month = "01";
            $dx_year = $_GET['year'] +1;
            $dx= 1;
        }
        else {

        $dx = 1;

        if($_GET['month']<9) {
       
            $dx_month = $_GET['month'] + 1;
            $dx_month = "0".$dx_month;
        } else {
            $dx_month = $_GET['month'] + 1;
        }
        $dx_year = $_GET['year'];
        }
    }   

    ?>
 
<div id="contenitore1" class="fluid ">
 <table align="center" width="100%" height="auto" border="1" cellspacing="5" class="cal" style="margin-top:100px;margin-left: -35px;">
    <tr>
  <col class="weekday" span="5">
  <col class="weekend">
  <col class="weekend">
  <thead>
      <tr><td colspan="8" style="color:#fff; font-size: 35px; height: 100%; background-color: #960a19;">
              <a href="./calendario.php?day=<?php echo $sx?>&month=<?php echo $sx_month?>&year=<?php echo $sx_year?>"><img src="img/sx.png" style="margin-right:15px;"></a>
                  <?php echo $realday. " - ".$_GET['month'] . " - " . $_GET['year']; ?>
              <a href="./calendario.php?day=<?php echo $dx?>&month=<?php echo $dx_month?>&year=<?php echo $dx_year?>"><img src="img/dx.png" style="margin-left:15px;"></a></td></tr></table>
              <?php 
              $query_attivita="SELECT * from attivita WHERE giorno=".$_GET['day']." AND mese=".$_GET['month']." AND anno=".$_GET['year']." AND id_utente=".$_SESSION['user_idd'];
              $result_attivita = mysql_query($query_attivita, $conn->db);
              
              $control_attivita=1;
                while ($row_attivita = mysql_fetch_array($result_attivita, MYSQL_ASSOC)) {?>
     <form action="" method="post">
              <table align="center" width="100%" height="auto" border="1" cellspacing="5" class="cal" style="margin-top:-32px; margin-left:-35px;border-bottom: 1px solid #000;">
                   <?php  if($control_attivita==1){
                        ?>
              <tr>
            <th><center><span style="color:#8ec25a;">Ora Inizio</span></center></th>
      <th><center><span style="color:#8ec25a;">Ora Fine</span></center></th>
      <th><center><span style="color:#8ec25a;">Durata</span></center></th>
      <th><center><span style="color:#8ec25a;">Descrizione</span></center></th>
      <th><center><span style="color:#8ec25a;">Commessa</span></center></th>
      <th><center><span style="color:#8ec25a;">Tipo</span></center></th>
      <th><center><span style="color:#8ec25a;">Modifica</span></center></th>
      <th><center><span style="color:#8ec25a;">Elimina</span></center></th>
      </tr>
          <?php
                    }
                    $control_attivita++;
      
                    ?>
     <tr>
        <td style="background-color: #fff;">
                    <select onchange="javascript:durata_tot(<?php echo $control_attivita?>);" id="ora_inizio<?php echo $control_attivita?>" name="ora_inizio">
                        <option>Ora</option>
                        <?php for($i=8;$i<21;$i++){
                            if($i<10) $t="0".$i;
                            else $t= $i;
                           ?>
                        <option <?php if(substr($row_attivita['ora_inizio'],0,2)==$t){ ?> selected="selected" <?php }?> value="<?php echo $t?>"><?php echo $t?></option>
                        <?php
                        }?>
            </select>
            <select name="minuti_inizio" onchange="javascript:durata_tot(<?php echo $control_attivita?>);" id="minuti_inizio<?php echo $control_attivita?>">
            <option>Minuti</option>
                        <?php for($i=0;$i<60;$i++){
                            if($i<10) $t="0".$i;
                            else $t= $i;
                           ?>
                        <option <?php if(substr($row_attivita['ora_inizio'],3,2)==$t){ ?> selected="selected" <?php }?> value="<?php echo $t?>"><?php echo $t?></option>
                        <?php
                        }?>
            </select>
        <td style="background-color: #fff;">
            <select onchange="javascript:durata_tot(<?php echo $control_attivita?>);" name="ora_fine" id="ora_fine<?php echo $control_attivita?>">
                        <option>Ora</option>
                        <?php for($i=8;$i<21;$i++){
                            if($i<10) $t="0".$i;
                            else $t= $i;
                           ?>
                        <option <?php if(substr($row_attivita['ora_fine'],0,2)==$t){ ?> selected="selected" <?php }?> value="<?php echo $t?>"><?php echo $t?></option>
                        <?php
                        }?>
            </select>
            <select onchange="javascript:durata_tot(<?php echo $control_attivita?>);" name="minuti_fine" id="minuti_fine<?php echo $control_attivita?>">
            <option>Minuti</option>
                        <?php for($i=0;$i<60;$i++){
                            if($i<10) $t="0".$i;
                            else $t= $i;
                           ?>
                        <option <?php if(substr($row_attivita['ora_fine'],3,2)==$t){ ?> selected="selected" <?php }?> value="<?php echo $t?>"><?php echo $t?></option>
                        <?php
                        }?>
            </select></td>
            <td style="background-color: #fff;"><input type="text" id="durata<?php echo $control_attivita?>" name="durata" value="<?php echo $row_attivita['ore_lavorate'];?>" style="width: 40px;"></td>
                    <td style="background-color: #fff;"><input type="text" name="descrizione_attivita" value="<?php echo $row_attivita['descrizione'];?>">
                    </td>
                            <td style="background-color: #fff;"><select name="commessa">
                                    <?php 
                                    
                                    $query="SELECT commesse from anagrafica WHERE user_id=".$_SESSION['user_idd'];
                                            $result=  mysql_query($query);
                                            
                                            while($row_commesse= mysql_fetch_array($result)){
                                                $commesse_utente=$row_commesse['commesse'];
                                               
                                            }
                                    $com_utente = explode("*", $commesse_utente);
                                    $query_commesse="";
                                    for($i=1;$i<count($com_utente)-1;$i++){
                                        if($i==1) $query_commesse.=" id_commessa='".$com_utente[$i]."'";
                                        else $query_commesse.= " OR id_commessa='".$com_utente[$i]."'";
                                    }
                                    $query="SELECT * from commesse WHERE";
                                    $query.= $query_commesse;
                                            $result=  mysql_query($query);
                                           
                                            while($row_commesse= mysql_fetch_array($result)){
                                            ?>
                                    <option value="<?php echo $row_commesse['nome_commessa']?>" 
                                        <?php if($row_attivita['commessa']==$row_commesse['nome_commessa']){ ?>selected="selected"<?php } ?> ><?php echo $row_commesse['nome_commessa']?></option>
                                    
                                            <?php } ?>
                        </select></td>
        <td style="background-color: #fff;"><select name="tipo">
                                    <option <?php if($row_attivita['tipo']=="P") {?>selected="selected"<?php }?> value="P">Presente</option>
                                    <option <?php if($row_attivita['tipo']=="PE") {?>selected="selected"<?php }?>value="PE">Permessi</option>
                                    <option <?php if($row_attivita['tipo']=="F") {?>selected="selected"<?php }?>value="F">Ferie</option>
                                    <option <?php if($row_attivita['tipo']=="FE") {?>selected="selected"<?php }?>value="FE">Festività</option>
                                    <option <?php if($row_attivita['tipo']=="M") {?>selected="selected"<?php }?>value="M">Maternità</option>
                        </select></td>
        <td style="background-color: #fff;">
            <input type="image" name="modifica" style="width: 100px;padding: 0; margin:0;" src="img/Save.png"
      onmouseover="this.src='img/salva2.png';"
      onmouseout="this.src='img/Save.png';"/>
        </td>
           <td style="background-color: #fff;">
            <input type="image" name="elimina" style="width: 100px; padding: 0; margin:0;" src="img/cancel.png"
      onmouseover="this.src='img/annulla2.png';"
      onmouseout="this.src='img/cancel.png';"/>
            <input type="hidden" name="id_attivita" value="<?php echo $row_attivita['id_attivita']?>">
           </td>
     </tr></table></form><?php
} 
                                         
              ?>
     <table align="center" width="100%" height="30px" border="1" cellspacing="0" style="margin-top:50px;margin-left:-35px;">
      <tr><td colspan="8" style="color:#8ec25a; font-size: 20px;background-color: #444;">
           Nuova Attività</td></tr></table>
     <form action="" method="post">
         <table align="center" width="100%" height="auto" border="1" cellspacing="5" class="cal" style="margin-top:-3px;margin-left:-35px;">
              <tr>
            <th><center><span style="color:#8ec25a;">Ora Inizio</span></center></th>
      <th><center><span style="color:#8ec25a;">Ora Fine</span></center></th>
      <th><center><span style="color:#8ec25a;">Durata</span></center></th>
      <th><center><span style="color:#8ec25a;">Descrizione</span></center></th>
      <th><center><span style="color:#8ec25a;">Commessa</span></center></th>
      <th><center><span style="color:#8ec25a;">Tipo</span></center></th>
      <th><center><span style="color:#8ec25a;">Aggiungi</span></center></th>
      <th><center><span style="color:#8ec25a;">Annulla</span></center></th>
      </tr>
      <tr>
        <td>
                    <select name="ora_inizio" onchange="javascript:durata_tot('0');" id="ora_inizio">
                        <option>Ora</option>
                        <?php for($i=8;$i<21;$i++){
                            if($i<10) $t="0".$i;
                            else $t= $i;
                           ?>
                        <option value="<?php echo $t?>"><?php echo $t?></option>
                        <?php
                        }?>
            </select>
            <select name="minuti_inizio" onchange="javascript:durata_tot('0');" id="minuti_inizio">
            <option>Minuti</option>
                        <?php for($i=0;$i<60;$i++){
                            if($i<10) $t="0".$i;
                            else $t= $i;
                           ?>
                        <option value="<?php echo $t?>"><?php echo $t?></option>
                        <?php
                        }?>
            </select>
        <td>
              <select name="ora_fine" onchange="javascript:durata_tot('0');" id="ora_fine">
                        <option>Ora</option>
                        <?php for($i=8;$i<21;$i++){
                            if($i<10) $t="0".$i;
                            else $t= $i;
                           ?>
                        <option value="<?php echo $t?>"><?php echo $t?></option>
                        <?php
                        }?>
            </select>
        <select name="minuti_fine" onchange="javascript:durata_tot('0');" id="minuti_fine">
            <option>Minuti</option>
                        <?php for($i=0;$i<60;$i++){
                            if($i<10) $t="0".$i;
                            else $t= $i;
                           ?>
                        <option value="<?php echo $t?>"><?php echo $t?></option>
                        <?php
                        }?>
            </select></td>
        <td><input type="text" name="durata" id="durata" value="" style="width: 40px;"></td>
                    <td><input type="text" name="descrizione_attivita" value="">
                    </td>
                            <td><select name="commessa">
                                       <?php 
                                    
                                    $query="SELECT commesse from anagrafica WHERE user_id=".$_SESSION['user_idd'];
                                            $result=  mysql_query($query);
                                            
                                            while($row_commesse= mysql_fetch_array($result)){
                                                $commesse_utente=$row_commesse['commesse'];
                                               
                                            }
                                    $com_utente = explode("*", $commesse_utente);
                                    $query_commesse="";
                                    for($i=1;$i<count($com_utente)-1;$i++){
                                        if($i==1) $query_commesse.=" id_commessa='".$com_utente[$i]."'";
                                        else $query_commesse.= " OR id_commessa='".$com_utente[$i]."'";
                                    }
                                    $query="SELECT * from commesse WHERE";
                                    $query.= $query_commesse;
                                            $result=  mysql_query($query);
                                           
                                            while($row_commesse= mysql_fetch_array($result)){
                                            ?>
                                    <option value="<?php echo $row_commesse['nome_commessa']?>" ><?php echo $row_commesse['nome_commessa']?></option>
                                    
                                            <?php } ?>
                        </select></td>
        <td style="background-color: #fff;"><select name="tipo">
                                    <option value="P">Presente</option>
                                    <option value="PE">Permessi</option>
                                    <option value="F">Ferie</option>
                                    <option value="FE">Festività</option>
                                    <option value="M">Maternità</option>
                        </select></td>
        <td style="background-color: #fff;">
            <input type="image" name="aggiungi" style="width: 100px;padding: 0; margin:0;" src="img/Save.png"
      onmouseover="this.src='img/salva2.png';"
      onmouseout="this.src='img/Save.png';"/></input>
        </td>
           <td style="background-color: #fff;">
            <input type="image" name="annulla" style="width: 100px; padding: 0; margin:0;" src="img/cancel.png"
      onmouseover="this.src='img/annulla2.png';"
      onmouseout="this.src='img/cancel.png';"
      onClick="window.location.reload()"></input>
        </td>
      </tr>
 
  </thead></table></form></div>
   <?php  
} else if(isset($_GET['id'])&&$_GET['id']=="attivita"){
    include('attivita.php');
} else if(isset($_GET['id'])&&$_GET['id']=="utenti"){
    include('riepilogo_commesse.php');
}
else {
?>
    <div style="margin-top:100px; margin-left: -35px;">
    <?php
    echo "<p align='center' style='color:red'>Per accedere alla pagina devi effettuare il <a href='/form/login.htm.php'>login</a></p>";
?>
    </div>
    <?php
}

?>

</body>
</html>